import"./modulepreload-polyfill.js";const w={method:"GET",interval:6e4},h={method:"POST"},l={read:w,write:h},m=(a,b)=>Object.prototype.hasOwnProperty.call(a,b),D=(c,b,e)=>{const a={};m(b,"sectionId")&&(a.sid=b.sectionId),m(b,"pageId")&&(a.pid=b.pageId);let d=!0;for(const b in a){if(m(a,b)){const e=a[b];e&&(c+=(d?"?":"&")+b+"="+encodeURIComponent(e))}d=!1}if(m(a,"sid")&&m(a,"pid")){const a=new XMLHttpRequest;a.open(l.read.method,c),a.onload=()=>{e(a.responseText)},a.send()}else console.error("no sectionId or pageId")},v=(d,b,e)=>{const c=new FormData;for(const a in b)b.hasOwnProperty(a)&&c.append(a,b[a]);const a=new XMLHttpRequest;a.open(l.write.method,d),a.onload=()=>{e(a.responseText)},a.send(c)},g=function(){const a=["cache"];window.caches.keys().then(b=>Promise.all(b.map(b=>{if(!a.includes(b))return window.caches.delete(b)})))},C=a=>{let b="";return a&&(b=a.replace(/(?:\r\n|\r|\n)/g,"<br>")),b},f=b=>{let a=null;return b&&(a=document.createElement("div"),a.className="row",a.innerHTML=b),a},y=(a,b,c)=>{let d="";return a&&c&&(d=`<div class="meta"><div class="name">${b?`<a href="${b}" target="_blank" rel="noopener">${a}</a>`:a}</div><div class="time">${c}</div></div>`),d},u=(b,e,c,f,a)=>{let d="";if(b&&c){let g="";a&&(a.toLowerCase()==="author"&&(g="from-author"),a.toLowerCase()==="to-be-approved"&&(g="to-be-approved"));const h=y(b,e,f);d=`<div class="msg ${g}">${c}</div>`+h}return d},I=a=>new Date(Date.now()).toLocaleDateString(a,{year:"numeric",month:"2-digit",day:"2-digit"}),b=(a,b,c)=>{if(a>0&&b&&c){const d=a===1?b:c.replace("%s",`${a}`),e=I("de-DE");return u("Der Reiskoch","https://www.der-reiskoch.de",d,e,"to-be-approved")}return""};let i=null;const E=e=>{const d=O(),a=document.getElementById("js-comments-output");a.innerHTML="";let c=null;try{c=JSON.parse(e)}catch(a){console.error(a)}if(c){const e=c.comments,g=c.numberOfToBeApprovedComments;if(g>0){const c=d?d.i18n:{},e=b(g,(c==null?void 0:c.toBeApprovedTextSingular)??"",(c==null?void 0:c.toBeApprovedTextPlural)??"");if(e&&a){const b=f(e);b&&a.appendChild(b)}}e&&e.forEach(b=>{const c=u(b.name,b.website,C(b.message),b.date,b.type);if(a){const b=f(c);b&&a.appendChild(b)}})}},p=()=>{if(g(),!i)return;const a=new FormData(i);if(a){const b=a.get("sid"),c=a.get("pid");if(b&&c){const a={sectionId:b,pageId:c};D(i.action,a,a=>{E(a)})}}},T=()=>{if(!i)return;const a=new FormData(i),b={sid:a.get("sid"),pid:a.get("pid"),name:a.get("name"),email:a.get("email"),website:a.get("website"),msg:a.get("message"),rating:a.get("rating")};v(i.action,b,a=>{a&&a.trim()==="OK"?(i.reset(),g(),p()):console.error(a)})},O=()=>{const a=document.getElementById("js-comments-config");let b={};if(a)try{b=JSON.parse(a.innerText)}catch{console.error("Error parsing comments config")}return b};window.addEventListener("load",()=>{if(i=document.getElementById("js-comments-form"),i&&i.addEventListener("submit",a=>{a.preventDefault(),a.stopPropagation(),console.log("submit comment form"),T()}),!i)return;const a=new FormData(i);a.get("sid")&&a.get("pid")&&(p(),setInterval(()=>{p()},l.read.interval))})